From 5b444b689e29d9f67e8190a8f15242ca9a1a70b9 Mon Sep 17 00:00:00 2001
From: Val Rasky <valentin@compulab.co.il>
Date: Mon, 3 Nov 2025 14:17:52 +0200
Subject: [PATCH] Add host and device mode for usb_0

Signed-off-by: Val Rasky <valentin@compulab.co.il>
---
 nv-platform/Makefile                          | 12 +++++++++++
 ...-p3768-0000+p3767-0000-nv-super-device.dts | 11 ++++++++++
 ...34-p3768-0000+p3767-0000-nv-super-host.dts | 12 +++++++++++
 ...-p3768-0000+p3767-0001-nv-super-device.dts | 15 ++++++++++++++
 ...34-p3768-0000+p3767-0001-nv-super-host.dts | 16 +++++++++++++++
 ...-p3768-0000+p3767-0003-nv-super-device.dts | 19 ++++++++++++++++++
 ...34-p3768-0000+p3767-0003-nv-super-host.dts | 20 +++++++++++++++++++
 ...-p3768-0000+p3767-0004-nv-super-device.dts | 19 ++++++++++++++++++
 ...34-p3768-0000+p3767-0004-nv-super-host.dts | 20 +++++++++++++++++++
 ...-p3768-0000+p3767-0005-nv-super-device.dts | 19 ++++++++++++++++++
 ...34-p3768-0000+p3767-0005-nv-super-host.dts | 20 +++++++++++++++++++
 tegra234-p3768-0000.dtsi                      |  2 +-
 12 files changed, 184 insertions(+), 1 deletion(-)
 create mode 100644 nv-platform/tegra234-p3768-0000+p3767-0000-nv-super-device.dts
 create mode 100644 nv-platform/tegra234-p3768-0000+p3767-0000-nv-super-host.dts
 create mode 100644 nv-platform/tegra234-p3768-0000+p3767-0001-nv-super-device.dts
 create mode 100644 nv-platform/tegra234-p3768-0000+p3767-0001-nv-super-host.dts
 create mode 100644 nv-platform/tegra234-p3768-0000+p3767-0003-nv-super-device.dts
 create mode 100644 nv-platform/tegra234-p3768-0000+p3767-0003-nv-super-host.dts
 create mode 100644 nv-platform/tegra234-p3768-0000+p3767-0004-nv-super-device.dts
 create mode 100644 nv-platform/tegra234-p3768-0000+p3767-0004-nv-super-host.dts
 create mode 100644 nv-platform/tegra234-p3768-0000+p3767-0005-nv-super-device.dts
 create mode 100644 nv-platform/tegra234-p3768-0000+p3767-0005-nv-super-host.dts

diff --git a/nv-platform/Makefile b/nv-platform/Makefile
index b1f47dc..36461b0 100644
--- a/nv-platform/Makefile
+++ b/nv-platform/Makefile
@@ -29,6 +29,18 @@ dtb-y += tegra234-p3768-0000+p3767-0004-nv-super.dtb
 dtb-y += tegra234-p3768-0000+p3767-0005-nv.dtb
 dtb-y += tegra234-p3768-0000+p3767-0005-nv-super.dtb
 
+dtb-y += tegra234-p3768-0000+p3767-0000-nv-super-host.dtb
+dtb-y += tegra234-p3768-0000+p3767-0001-nv-super-host.dtb
+dtb-y += tegra234-p3768-0000+p3767-0003-nv-super-host.dtb
+dtb-y += tegra234-p3768-0000+p3767-0004-nv-super-host.dtb
+dtb-y += tegra234-p3768-0000+p3767-0005-nv-super-host.dtb
+
+dtb-y += tegra234-p3768-0000+p3767-0000-nv-super-device.dtb
+dtb-y += tegra234-p3768-0000+p3767-0001-nv-super-device.dtb
+dtb-y += tegra234-p3768-0000+p3767-0003-nv-super-device.dtb
+dtb-y += tegra234-p3768-0000+p3767-0004-nv-super-device.dtb
+dtb-y += tegra234-p3768-0000+p3767-0005-nv-super-device.dtb
+
 ifneq ($(dtb-y),)
 dtb-y := $(addprefix $(makefile-path)/,$(dtb-y))
 endif
diff --git a/nv-platform/tegra234-p3768-0000+p3767-0000-nv-super-device.dts b/nv-platform/tegra234-p3768-0000+p3767-0000-nv-super-device.dts
new file mode 100644
index 0000000..8f3159b
--- /dev/null
+++ b/nv-platform/tegra234-p3768-0000+p3767-0000-nv-super-device.dts
@@ -0,0 +1,11 @@
+// SPDX-License-Identifier: GPL-2.0-only
+// SPDX-FileCopyrightText: Copyright (c) 2023, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.
+
+/dts-v1/;
+
+#include "tegra234-p3768-0000+p3767-0000.dts"
+#include "tegra234-p3768-0000+p3767-xxxx-nv-common.dtsi"
+
+&usb_recovery {
+    mode = "device";
+};
diff --git a/nv-platform/tegra234-p3768-0000+p3767-0000-nv-super-host.dts b/nv-platform/tegra234-p3768-0000+p3767-0000-nv-super-host.dts
new file mode 100644
index 0000000..326cf50
--- /dev/null
+++ b/nv-platform/tegra234-p3768-0000+p3767-0000-nv-super-host.dts
@@ -0,0 +1,12 @@
+// SPDX-License-Identifier: GPL-2.0-only
+// SPDX-FileCopyrightText: Copyright (c) 2023, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.
+
+/dts-v1/;
+
+#include "tegra234-p3768-0000+p3767-0000.dts"
+#include "tegra234-p3768-0000+p3767-xxxx-nv-common.dtsi"
+
+&usb_recovery {
+    mode = "host";
+    /delete-property/ usb-role-switch;
+};
diff --git a/nv-platform/tegra234-p3768-0000+p3767-0001-nv-super-device.dts b/nv-platform/tegra234-p3768-0000+p3767-0001-nv-super-device.dts
new file mode 100644
index 0000000..7d34cad
--- /dev/null
+++ b/nv-platform/tegra234-p3768-0000+p3767-0001-nv-super-device.dts
@@ -0,0 +1,15 @@
+// SPDX-License-Identifier: GPL-2.0
+// SPDX-FileCopyrightText: Copyright (c) 2024, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.
+
+/dts-v1/;
+
+#include "tegra234-p3768-0000+p3767-0001-nv.dts"
+
+/ {
+	compatible = "nvidia,p3768-0000+p3767-0001-super", "nvidia,p3767-0001", "nvidia,tegra234";
+	model = "NVIDIA Jetson Orin NX Engineering Reference Developer Kit Super";
+};
+
+&usb_recovery {
+    mode = "device";
+};
diff --git a/nv-platform/tegra234-p3768-0000+p3767-0001-nv-super-host.dts b/nv-platform/tegra234-p3768-0000+p3767-0001-nv-super-host.dts
new file mode 100644
index 0000000..a7d1601
--- /dev/null
+++ b/nv-platform/tegra234-p3768-0000+p3767-0001-nv-super-host.dts
@@ -0,0 +1,16 @@
+// SPDX-License-Identifier: GPL-2.0
+// SPDX-FileCopyrightText: Copyright (c) 2024, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.
+
+/dts-v1/;
+
+#include "tegra234-p3768-0000+p3767-0001-nv.dts"
+
+/ {
+	compatible = "nvidia,p3768-0000+p3767-0001-super", "nvidia,p3767-0001", "nvidia,tegra234";
+	model = "NVIDIA Jetson Orin NX Engineering Reference Developer Kit Super";
+};
+
+&usb_recovery {
+    mode = "host";
+    /delete-property/ usb-role-switch;
+};
diff --git a/nv-platform/tegra234-p3768-0000+p3767-0003-nv-super-device.dts b/nv-platform/tegra234-p3768-0000+p3767-0003-nv-super-device.dts
new file mode 100644
index 0000000..1762d8a
--- /dev/null
+++ b/nv-platform/tegra234-p3768-0000+p3767-0003-nv-super-device.dts
@@ -0,0 +1,19 @@
+// SPDX-License-Identifier: GPL-2.0
+// SPDX-FileCopyrightText: Copyright (c) 2024, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.
+
+/dts-v1/;
+
+#include "tegra234-p3768-0000+p3767-0003-nv.dts"
+
+/ {
+	compatible = "nvidia,p3768-0000+p3767-0003-super", "nvidia,p3767-0003", "nvidia,tegra234";
+	model = "NVIDIA Jetson Orin Nano Engineering Reference Developer Kit Super";
+};
+
+/delete-node/ &{/opp-table-cluster0/opp-1510400000};
+/delete-node/ &{/opp-table-cluster1/opp-1510400000};
+/delete-node/ &{/opp-table-cluster2/opp-1510400000};
+
+&usb_recovery {
+    mode = "device";
+};
diff --git a/nv-platform/tegra234-p3768-0000+p3767-0003-nv-super-host.dts b/nv-platform/tegra234-p3768-0000+p3767-0003-nv-super-host.dts
new file mode 100644
index 0000000..383efb4
--- /dev/null
+++ b/nv-platform/tegra234-p3768-0000+p3767-0003-nv-super-host.dts
@@ -0,0 +1,20 @@
+// SPDX-License-Identifier: GPL-2.0
+// SPDX-FileCopyrightText: Copyright (c) 2024, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.
+
+/dts-v1/;
+
+#include "tegra234-p3768-0000+p3767-0003-nv.dts"
+
+/ {
+	compatible = "nvidia,p3768-0000+p3767-0003-super", "nvidia,p3767-0003", "nvidia,tegra234";
+	model = "NVIDIA Jetson Orin Nano Engineering Reference Developer Kit Super";
+};
+
+/delete-node/ &{/opp-table-cluster0/opp-1510400000};
+/delete-node/ &{/opp-table-cluster1/opp-1510400000};
+/delete-node/ &{/opp-table-cluster2/opp-1510400000};
+
+&usb_recovery {
+    mode = "host";
+    /delete-property/ usb-role-switch;
+};
diff --git a/nv-platform/tegra234-p3768-0000+p3767-0004-nv-super-device.dts b/nv-platform/tegra234-p3768-0000+p3767-0004-nv-super-device.dts
new file mode 100644
index 0000000..b91fdfa
--- /dev/null
+++ b/nv-platform/tegra234-p3768-0000+p3767-0004-nv-super-device.dts
@@ -0,0 +1,19 @@
+// SPDX-License-Identifier: GPL-2.0
+// SPDX-FileCopyrightText: Copyright (c) 2024, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.
+
+/dts-v1/;
+
+#include "tegra234-p3768-0000+p3767-0004-nv.dts"
+
+/ {
+	compatible = "nvidia,p3768-0000+p3767-0004-super", "nvidia,p3767-0004", "nvidia,tegra234";
+	model = "CompuLab NVIDIA Jetson Orin Nano";
+};
+
+/delete-node/ &{/opp-table-cluster0/opp-1510400000};
+/delete-node/ &{/opp-table-cluster1/opp-1510400000};
+/delete-node/ &{/opp-table-cluster2/opp-1510400000};
+
+&usb_recovery {
+    mode = "device";
+};
diff --git a/nv-platform/tegra234-p3768-0000+p3767-0004-nv-super-host.dts b/nv-platform/tegra234-p3768-0000+p3767-0004-nv-super-host.dts
new file mode 100644
index 0000000..5287e42
--- /dev/null
+++ b/nv-platform/tegra234-p3768-0000+p3767-0004-nv-super-host.dts
@@ -0,0 +1,20 @@
+// SPDX-License-Identifier: GPL-2.0
+// SPDX-FileCopyrightText: Copyright (c) 2024, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.
+
+/dts-v1/;
+
+#include "tegra234-p3768-0000+p3767-0004-nv.dts"
+
+/ {
+	compatible = "nvidia,p3768-0000+p3767-0004-super", "nvidia,p3767-0004", "nvidia,tegra234";
+	model = "CompuLab NVIDIA Jetson Orin Nano";
+};
+
+/delete-node/ &{/opp-table-cluster0/opp-1510400000};
+/delete-node/ &{/opp-table-cluster1/opp-1510400000};
+/delete-node/ &{/opp-table-cluster2/opp-1510400000};
+
+&usb_recovery {
+    mode = "host";
+    /delete-property/ usb-role-switch;
+};
diff --git a/nv-platform/tegra234-p3768-0000+p3767-0005-nv-super-device.dts b/nv-platform/tegra234-p3768-0000+p3767-0005-nv-super-device.dts
new file mode 100644
index 0000000..06a599b
--- /dev/null
+++ b/nv-platform/tegra234-p3768-0000+p3767-0005-nv-super-device.dts
@@ -0,0 +1,19 @@
+// SPDX-License-Identifier: GPL-2.0
+// SPDX-FileCopyrightText: Copyright (c) 2024, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.
+
+/dts-v1/;
+
+#include "tegra234-p3768-0000+p3767-0005-nv.dts"
+
+/ {
+	compatible = "nvidia,p3768-0000+p3767-0005-super", "nvidia,p3767-0005", "nvidia,tegra234";
+	model = "CompuLab NVIDIA Jetson Orin Nano";
+};
+
+/delete-node/ &{/opp-table-cluster0/opp-1510400000};
+/delete-node/ &{/opp-table-cluster1/opp-1510400000};
+/delete-node/ &{/opp-table-cluster2/opp-1510400000};
+
+&usb_recovery {
+    mode = "device";
+};
diff --git a/nv-platform/tegra234-p3768-0000+p3767-0005-nv-super-host.dts b/nv-platform/tegra234-p3768-0000+p3767-0005-nv-super-host.dts
new file mode 100644
index 0000000..021d2a5
--- /dev/null
+++ b/nv-platform/tegra234-p3768-0000+p3767-0005-nv-super-host.dts
@@ -0,0 +1,20 @@
+// SPDX-License-Identifier: GPL-2.0
+// SPDX-FileCopyrightText: Copyright (c) 2024, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.
+
+/dts-v1/;
+
+#include "tegra234-p3768-0000+p3767-0005-nv.dts"
+
+/ {
+	compatible = "nvidia,p3768-0000+p3767-0005-super", "nvidia,p3767-0005", "nvidia,tegra234";
+	model = "CompuLab NVIDIA Jetson Orin Nano";
+};
+
+/delete-node/ &{/opp-table-cluster0/opp-1510400000};
+/delete-node/ &{/opp-table-cluster1/opp-1510400000};
+/delete-node/ &{/opp-table-cluster2/opp-1510400000};
+
+&usb_recovery {
+    mode = "host";
+    /delete-property/ usb-role-switch;
+};
diff --git a/tegra234-p3768-0000.dtsi b/tegra234-p3768-0000.dtsi
index 15a1491..5ed9f69 100644
--- a/tegra234-p3768-0000.dtsi
+++ b/tegra234-p3768-0000.dtsi
@@ -79,7 +79,7 @@
 
 			ports {
 				/* recovery port */
-				usb2-0 {
+				usb_recovery: usb2-0 {
 					mode = "otg";
 					vbus-supply = <&vdd_5v0_sys>;
 					status = "okay";
-- 
2.34.1

